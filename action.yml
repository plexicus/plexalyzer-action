# action.yml
name: 'COVULOR Plexalyzer'
description: 'Official Plexicus code analyzer for COVULOR cloud service'
author: 'Plexicus'
branding:
  icon: 'shield'
  color: 'blue'
inputs:
  plexalyzer-token:
    description: 'Authentication token for COVULOR cloud service'
    required: true
  repo-id:
    description: 'Repository ID in COVULOR service'
    required: true
  repo-name:
    description: 'Name of the repository'
    required: true
  branch:
    description: 'Branch name for the pull request'
    required: true
  url:
    description: 'Clone URL of the repository'
    required: true
  files-path:
    description: 'Path to file containing files list for scanning'
    required: true
runs:
  using: 'docker'
  image: 'docker://plexicus/plexalyzer:latest'
  entrypoint: '/venvs/plexicus-fastapi/bin/python'
  env:
    PLEXALYZER_TOKEN: ${{ inputs.plexalyzer-token }}
    MESSAGE_URL: 'http://fastapi.covulor-prd.svc.cluster.local:8000/receive_plexalyzer_message'
  args:
    - "/app/analyze.py"
    - "--repository_id"
    - ${{ inputs.repo-id }}
    - "--name"
    - ${{ inputs.repo-name }}
    - "--branch"
    - ${{ inputs.branch }}
    - "--url"
    - ${{ inputs.url }}
    - "--files"
    - ${{ inputs.files-path }}
